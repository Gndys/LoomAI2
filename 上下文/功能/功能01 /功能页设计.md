# 功能01：AI 图片生成功能页

## 一、页面定位

**这是一个独立的功能页**，不是主页，路径：`/ai-generate`

**核心价值**：
- 快速：3步完成生成（上传 → 选择功能 → 生成）
- 专注：只做图片生成，不做其他
- 灵活：既可以用预设功能，也可以自定义提示词

**页面目标**：
- 用户从导航栏点击"AI生成"进入此页
- 完成图片生成任务后下载或返回

---

## 二、功能页布局设计

### 2.1 页面整体结构（单页面，垂直滚动）

```
┌─────────────────────────────────────────────────────────┐
│  [Logo] 首页 | AI生成 | 历史 | [积分: 100]             │
├─────────────────────────────────────────────────────────┤
│                                                         │
│                  AI 图片生成                             │
│                                                         │
│  ┌─────────────────────────────────────────────────┐   │
│  │  选择功能（横向滚动）                            │   │
│  │  ← [📸平铺图] [✏️线稿] [🎨宣传图] [📐版型] →   │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  ┌──────────────────┐  ┌──────────────────┐           │
│  │                  │  │                  │           │
│  │   上传图片       │  │   生成结果        │           │
│  │                  │  │                  │           │
│  │  [拖拽上传]      │  │  [等待生成]      │           │
│  │                  │  │                  │           │
│  └──────────────────┘  └──────────────────┘           │
│                                                         │
│  ┌─────────────────────────────────────────────────┐   │
│  │  提示词（自动填充，可编辑）                      │   │
│  │  [flat lay product photography...]              │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  [Auto ▼] [无风格 ▼] [Loom Pro ▼]                     │
│                                                         │
│  [+ 负面提示词] [🎲 随机] [🗑️ 清除]                   │
│                                                         │
│              [🚀 生成图片] (消耗 10 积分)              │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 2.1E 版本 E（参考 AI Image Generator 的选项交互）

**核心变化**：把“参数菜单”改成**选项胶囊 + 就地展开面板**，并把**上传后的图片**放在提示词卡片内部左侧，形成“图 + 文”一体化编辑区。

```
┌─────────────────────────────────────────────────────────┐
│  [Logo] 首页 | AI生成 | 历史 | [积分: 100]             │
├─────────────────────────────────────────────────────────┤
│                                                         │
│                  AI 图片生成                             │
│                                                         │
│  ┌─────────────────────────────────────────────────┐   │
│  │  描述提示词                                       │   │
│  │  [已上传缩略图]  What do you want to see?        │   │
│  │                                                 │   │
│  │  [1:1] [No Style] [No Color] [No Lighting ▾]    │   │
│  │                                                 │   │
│  │  ┌──────────────  Lighting 面板  ─────────────┐  │   │
│  │  │ None | Dramatic | Dimly Lit | Studio ...   │  │   │
│  │  │ Golden Hour | Backlight | Rim Lighting ... │  │   │
│  │  └────────────────────────────────────────────┘  │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  ┌──────────────────┐  ┌──────────────────┐           │
│  │   上传图片       │  │   生成结果        │           │
│  │  [Add Image]     │  │  [等待生成]      │           │
│  └──────────────────┘  └──────────────────┘           │
│                                                         │
│  [Auto] [无风格] [Loom Pro]     [清除] [随机] [生成]   │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

**菜单位置（选项交互）**：
- 选项胶囊（如 `No Lighting`）放在提示词卡片底部一行。
- 点击胶囊后，**菜单面板在同卡片内就地展开**，与胶囊左对齐，覆盖在提示词下方的留白区域。
- 菜单为**多列网格**，可一次展示 8–12 项，点击即选并高亮，点击空白处收起。

**图片上传后的位置**：
- 上传成功后，**缩略图固定在提示词卡片左侧**，与提示词输入同一行。
- 缩略图右上角提供 `×` 删除；删除后提示词输入自动回到全宽。
- 若图片较高，缩略图保持固定宽度（例如 96px），高度自适应并裁切圆角。

**适配原则**：
- 桌面端：缩略图 + 提示词同排；选项面板覆盖卡片内部，不遮挡底部主按钮。
- 移动端：缩略图移到提示词上方，选项面板改为底部抽屉或全宽弹层。


### 2.2 功能选择区（横向滚动卡片）

**设计要点**：
- 横向滚动（参考 raphael.app）
- 每个卡片包含：图标 + 名称 + 小预览图 + 说明
- 点击后高亮显示，自动填充提示词
- 移动端友好（可滑动）

**5个预设功能**：
1. 📸 平铺图 - 商品展示
2. ✏️ 线稿 - 技术制版
3. 🎨 宣传图 - 社交媒体
4. 📐 版型 - 结构分析
5. 🔄 改色 - 配色方案

### 2.3 图片上传和结果展示区（左右布局）

**左侧：上传区**
- 拖拽上传支持
- 点击上传支持
- 显示文件大小限制（最大 10MB）
- 支持格式：PNG、JPG

**右侧：结果区**
- 未生成：显示占位文字
- 生成中：显示进度条和加载动画
- 生成完成：显示结果图片 + 下载按钮

### 2.4 提示词编辑区

**正向提示词**：
- 始终显示
- 自动填充（点击功能卡片后）
- 可手动编辑

**负面提示词**：
- 默认隐藏
- 点击"+ 负面提示词"按钮展开
- 可手动编辑

**操作按钮**：
- 🎲 随机：生成示例提示词
- 🗑️ 清除：重置所有设置

### 2.5 参数控制区（下拉菜单）

**3个参数**：
1. **Auto** - 尺寸选择（1:1、16:9、9:16、自定义）
2. **无风格** - 风格选择（无风格、技术线稿、生活方式等）
3. **Loom Pro** - 模型选择（固定为 Loom Pro）

**设计要点**：
- 不用滑块，用下拉菜单
- 点击才展开选项
- 选中后显示当前值

### 2.6 生成按钮

- 橙色大按钮（主要操作）
- 显示消耗积分
- 禁用状态：未上传图片或未填写提示词
- 生成中显示进度条

---

## 三、交互流程

### 3.1 标准流程（3步）

```
Step 1: 选择功能
  ↓
  用户点击功能卡片（如"📸 平铺图"）
  ↓
  卡片高亮，自动填充提示词

Step 2: 上传图片
  ↓
  用户拖拽/点击上传图片
  ↓
  图片显示在左侧预览区

Step 3: 生成
  ↓
  （可选）调整提示词或参数
  ↓
  点击"生成图片"按钮
  ↓
  显示进度条（30秒）
  ↓
  右侧显示生成结果
  ↓
  【满意】点击下载
  【不满意】调整参数 → 重新生成
```

### 3.2 功能卡片点击行为

```javascript
// 点击"📸 平铺图"卡片
function handleFunctionClick(functionType: 'flat-lay') {
  // 1. 高亮当前卡片
  setSelectedFunction('flat-lay')
  
  // 2. 自动填充提示词
  setPrompt(promptTemplates['flat-lay'].positive)
  setNegativePrompt(promptTemplates['flat-lay'].negative)
  
  // 3. 设置默认参数
  setSize('Auto')
  setStyle('无风格')
  
  // 4. Toast 提示
  toast.success('已加载平铺图模板')
}
```

### 3.3 参数下拉菜单交互

```javascript
// 点击 [Auto ▼] 按钮
const [showSizeMenu, setShowSizeMenu] = useState(false)

<button onClick={() => setShowSizeMenu(!showSizeMenu)}>
  {selectedSize} <ChevronDown />
</button>

{showSizeMenu && (
  <div className="absolute mt-2 bg-white border rounded-lg shadow-lg">
    <div onClick={() => selectSize('1:1')}>1:1 正方形</div>
    <div onClick={() => selectSize('16:9')}>16:9 横屏</div>
    <div onClick={() => selectSize('9:16')}>9:16 竖屏</div>
  </div>
)}
```

### 3.4 负面提示词展开/收起

```javascript
const [showNegative, setShowNegative] = useState(false)

<button onClick={() => setShowNegative(!showNegative)}>
  {showNegative ? '- 隐藏负面提示词' : '+ 负面提示词'}
</button>

{showNegative && (
  <textarea 
    value={negativePrompt}
    onChange={(e) => setNegativePrompt(e.target.value)}
    placeholder="描述你不想要的元素..."
  />
)}
```

---

## 四、内置功能详解

### 功能1：📸 平铺图生成

**用户场景**：模特图/街拍图 → 商品平铺图

**自动填充的提示词**：
```
正向：flat lay product photography, white background, top view, centered, professional lighting, clean, minimal

负向：person, model, human, hands, face, body, UI elements, text, watermark, shadows, wrinkles, accessories
```

**参数预设**：Auto / 无风格 / Loom Pro

---

### 功能2：✏️ 服装线稿生成

**用户场景**：平铺图 → 技术线稿（用于制版）

**自动填充的提示词**：
```
正向：technical fashion sketch, clean line drawing, black lines on white background, detailed stitching lines, construction lines, flat pattern view

负向：color, shading, texture, photo, realistic, model, person, shadows
```

**参数预设**：Auto / 技术线稿 / Loom Pro

---

### 功能3：🎨 宣传图生成

**用户场景**：平铺图 → 带场景的宣传图

**自动填充的提示词**：
```
正向：lifestyle product photography, natural lighting, aesthetic composition, minimalist scene, soft shadows, professional styling

负向：cluttered, messy, low quality, distorted, unrealistic
```

**参数预设**：16:9 / 生活方式 / Loom Pro

---

### 功能4：📐 版型拆解

**用户场景**：完整服装 → 拆解成各个部件

**自动填充的提示词**：
```
正向：exploded view, pattern pieces separated, technical illustration, flat lay of garment components, labeled parts, construction breakdown

负向：assembled, complete garment, model, person, shadows
```

**参数预设**：Auto / 技术插图 / Loom Pro

---

### 功能5：🔄 智能改色

**用户场景**：保持款式不变，只改变颜色

**自动填充的提示词**：
```
正向：same design, same style, same cut, change color to [用户选择], preserve all details

负向：different style, different design, pattern change, texture change
```

**参数预设**：Auto / 保持原样 / Loom Pro

---

## 五、响应式设计

### 桌面端（>1024px）

- 左右布局（50% / 50%）
- 功能卡片横向滚动
- 参数控制横向排列

### 平板端（768px - 1024px）

- 左右布局（50% / 50%）
- 功能卡片横向滚动
- 参数控制横向排列

### 移动端（<768px）

- 上下布局（100%）
- 功能卡片横向滚动
- 参数控制堆叠排列

---

## 六、开发计划（1周 MVP）

### Day 1-2：页面布局和组件
- [ ] 页面主文件（`/ai-generate/page.tsx`）
- [ ] 功能选择组件（横向滚动卡片）
- [ ] 图片上传组件（拖拽支持）
- [ ] 结果展示组件

### Day 3-4：核心功能
- [ ] 提示词引擎（5个预设模板）
- [ ] 参数控制组件（下拉菜单）
- [ ] 提示词编辑器（可展开负面提示词）
- [ ] 随机提示词功能

### Day 5：API 集成
- [ ] API 路由（`/api/ai/generate`）
- [ ] 调用 Gemini API
- [ ] 图片上传和下载

### Day 6：体验优化
- [ ] 进度条和加载动画
- [ ] Toast 提示
- [ ] 错误处理
- [ ] 响应式适配

### Day 7：测试上线
- [ ] 真实图片测试
- [ ] 调整提示词模板
- [ ] 性能优化
- [ ] 部署上线

---

## 七、技术实现要点

### 文件结构

```
/apps/next-app/app/[lang]/ai-generate/
  ├── page.tsx                      # 主页面
  ├── components/
  │   ├── FunctionSelector.tsx      # 功能选择组件
  │   ├── ImageUploader.tsx         # 图片上传组件
  │   ├── ResultDisplay.tsx         # 结果展示组件
  │   ├── PromptEditor.tsx          # 提示词编辑器
  │   ├── ParamControls.tsx         # 参数控制组件
  │   └── GenerateButton.tsx        # 生成按钮组件

/libs/ai/
  ├── prompt-engine.ts              # 提示词引擎
  └── types.ts                      # 类型定义

/apps/next-app/app/api/ai/generate/
  └── route.ts                      # API 路由
```

### 关键技术点

1. **横向滚动**：使用 `overflow-x: auto` + `scroll-snap`
2. **下拉菜单**：使用 Headless UI 或自己实现
3. **图片上传**：使用 `react-dropzone`
4. **状态管理**：使用 React useState
5. **API 调用**：使用 fetch + loading 状态

---

## 八、验证指标

### 产品指标
- **生成成功率**：>90%
- **首次满意度**：>60%（用户直接下载）
- **功能使用分布**：平铺图 > 线稿 > 宣传图 > 版型 > 改色

### 技术指标
- **生成速度**：<30秒
- **API 成本**：<$0.05/次
- **页面加载速度**：<2秒

---

## 九、总结

这是一个**纯粹的功能页**，特点：

1. **专注**：只做图片生成，不做其他
2. **简洁**：3步完成，无多余元素
3. **灵活**：预设 + 自定义，满足不同用户
4. **高效**：横向滚动 + 下拉菜单，节省空间
5. **专业**：参考 raphael.app，品牌化命名

**与主页的区别**：
- 主页：介绍产品 + 引导注册
- 功能页：完成任务 + 快速生成

**下一步**：等你确认方案后，我开始写代码。

# 模特氛围图功能页前端实现任务清单（可直接开工）

> 基于当前仓库结构（Next.js App Router）拆解。  
> 目标：先快速上线 V1，再逐步补齐 i18n 与真实 API。

## 0. 实施策略（建议）

- Phase A（快速可用）：先复用白底页模式，单文件实现页面闭环
- Phase B（可维护）：再拆子组件、接入 i18n、联动白底页与海报页

---

## 1. 路由与页面骨架

- [ ] 新建页面：`apps/next-app/app/[lang]/(root)/model-atmosphere/page.tsx`
- [ ] 复用壳组件：`FeaturePageShell` + `FeatureCard`
- [ ] 完成模块骨架：Hero / 上传 / 模板 / 设置 / 结果 / 质检 / 导出 / 下一步

验收：
- [ ] 可访问 `/{lang}/model-atmosphere`
- [ ] 页面布局在桌面和移动端均不破版

---

## 2. 数据类型与常量

- [ ] 在页面内定义 V1 类型：
  - `UploadItem`
  - `ResultItem`
  - `TemplateType`
  - `QualityLevel`
  - `ModelConfig`
  - `OutputConfig`
- [ ] 定义模板常量（4个）与默认配置
- [ ] 定义约束常量：`MAX_FILE_SIZE`、`MAX_BATCH`

验收：
- [ ] 类型无 `any` 漏出
- [ ] 模板切换可正确更新推荐参数

---

## 3. 上传与队列管理

参考实现：`apps/next-app/app/[lang]/(root)/product-white-background/page.tsx`

- [ ] 支持拖拽上传 + 点击上传
- [ ] 支持格式校验（JPG/PNG/WEBP）
- [ ] 支持体积校验（15MB）
- [ ] 支持批量上限（建议 20）
- [ ] 队列项支持删除、失败重试

验收：
- [ ] 错误提示清晰（toast）
- [ ] 清空队列后释放预览 URL

---

## 4. 模板与设置交互

- [ ] 实现模板卡片区（4卡片）
- [ ] 点击模板后自动填充设置
- [ ] 设置区实现下拉/单选：性别、年龄、体型、姿态、表情
- [ ] 输出参数：比例、背景强度、命名规则
- [ ] 提供“恢复推荐设置”按钮

验收：
- [ ] 默认值可直接生成
- [ ] 任意修改后 UI 有“已自定义”反馈（可选）

---

## 5. 生成与结果渲染

### 5.1 V1（Mock 先跑通）
- [ ] 先实现 `generateMockResults()` 跑通完整交互
- [ ] 状态流：`ready -> processing -> done/failed`
- [ ] 结果区支持筛选（全部/通过/复检/失败）
- [ ] 单卡操作：对比、再生成、下载

### 5.2 V1.1（接真实 API）
- [ ] 新增接口：`apps/next-app/app/api/model-atmosphere/route.ts`
- [ ] 请求体：图片 + 模板 + 模特参数 + 输出参数
- [ ] 响应体：结果图 URL + 质检项 + 失败原因
- [ ] 前端改为真实请求并补充错误态

验收：
- [ ] 处理中态与失败态可视
- [ ] 单图重试不阻塞整批任务

---

## 6. 导出与命名

- [ ] 单图下载
- [ ] 批量导出（V1 可先“逐张触发下载”）
- [ ] 命名规则：`原文件名_模板名_模特`
- [ ] 增加“仅导出已通过”开关

验收：
- [ ] 导出文件名稳定可读
- [ ] 无可导出项时给出明确提示

---

## 7. 导航入口与链路打通

### 7.1 顶部导航
- [ ] 桌面端入口：`apps/next-app/components/global-header.tsx`
- [ ] 移动端入口：`apps/next-app/components/global-header.tsx`
- [ ] 入口文案：模特氛围图 + 一句价值说明

### 7.2 上下游页面联动
- [ ] 在白底页增加“去生成模特图”跳转
  - 文件：`apps/next-app/app/[lang]/(root)/product-white-background/page.tsx`
- [ ] 在模特页增加“去生成海报”跳转（占位即可）

验收：
- [ ] 可从导航直达
- [ ] 可从白底页顺畅流转

---

## 8. 国际化（建议分两步）

### 8.1 快速版（可选）
- [ ] 先沿用中文硬编码，先上线验证

### 8.2 正式版（推荐）
- [ ] 补齐翻译字段：
  - `libs/i18n/locales/zh-CN.ts`
  - `libs/i18n/locales/en.ts`
- [ ] 页面改为 `useTranslation()` 取值
- [ ] 导航文案也迁移到翻译文件

验收：
- [ ] `pnpm --filter next-app build` 无翻译缺失导致的构建问题

---

## 9. 埋点与运营数据

- [ ] 定义埋点事件（最小集）：
  - 点击上传
  - 上传成功
  - 模板选择
  - 点击生成
  - 生成成功
  - 批量导出
  - 点击去海报
- [ ] 若暂未接埋点 SDK，先留统一 `track()` 占位

验收：
- [ ] 关键漏斗可回放：访问 -> 上传 -> 选模板 -> 生成 -> 导出

---

## 10. 测试与验收清单

### 10.1 自测脚本（手工）
- [ ] 单图上传并生成成功
- [ ] 批量 20 张上传并可导出
- [ ] 非图片、超大图可正确拦截
- [ ] 失败项可重试
- [ ] 移动端布局可用

### 10.2 构建检查
- [ ] `pnpm --filter next-app lint`（如项目启用）
- [ ] `pnpm --filter next-app build`

---

## 11. 建议排期（5天）

- Day 1：页面骨架 + 上传队列
- Day 2：模板区 + 设置区 + 结果区（Mock）
- Day 3：导出、状态、质检提示
- Day 4：导航入口 + 白底链路打通
- Day 5：i18n/自测/构建修正

---

## 12. 完成定义（DoD）

- [ ] 用户可在 `/{lang}/model-atmosphere` 完成 3 步出图
- [ ] 支持批量并可导出
- [ ] 页面可从导航与白底页进入
- [ ] 状态、错误、空态完整
- [ ] 构建通过（至少 next-app）
